@model Municipal_Servcies_Portal.ViewModels.ServiceRequestDetailViewModel
@{
    ViewData["Title"] = $"Request #{Model.Id} - Details";
}

<link rel="stylesheet" href="~/css/servicerequest.css" />

<div class="service-request service-request__details">
    <!-- Header Section with Breadcrumb -->
    <header class="service-request__header">
        <nav class="service-request__breadcrumb" aria-label="Breadcrumb">
            <a href="/" class="service-request__breadcrumb-link">Home</a>
            <span class="service-request__breadcrumb-separator">
                <svg width="8" height="12" viewBox="0 0 8 12" fill="none">
                    <path d="M2 2l4 4-4 4" stroke="#6B7280" stroke-width="2" fill="none"/>
                </svg>
            </span>
            <a href="/ServiceRequest" class="service-request__breadcrumb-link">Service Requests</a>
            <span class="service-request__breadcrumb-separator">
                <svg width="8" height="12" viewBox="0 0 8 12" fill="none">
                    <path d="M2 2l4 4-4 4" stroke="#6B7280" stroke-width="2" fill="none"/>
                </svg>
            </span>
            <span class="service-request__breadcrumb-link service-request__breadcrumb-link--active">Request #@Model.Id</span>
        </nav>
        
        <h1 class="service-request__title">Service Request Details</h1>
        <p class="service-request__description">Track status and view comprehensive information about this service request</p>
    </header>

    <!-- Main Details Card -->
    <div class="service-request__details-card">
        <!-- Header with ID, Category, Status, and Priority -->
        <div class="service-request__details-header">
            <div class="service-request__details-header-left">
                <h2 class="service-request__details-id">#MSP-@DateTime.Now.Year-@Model.Id.ToString("D6")</h2>
                <span class="service-request__details-category">@Model.Category</span>
            </div>
            <div class="service-request__details-header-right">
                @{
                    var statusClass = Model.Status?.ToLower() switch
                    {
                        "pending" => "service-request__status--pending",
                        "inprogress" => "service-request__status--inprogress",
                        "completed" => "service-request__status--completed",
                        "cancelled" => "service-request__status--cancelled",
                        _ => "service-request__status--pending"
                    };
                }
                <span class="service-request__status @statusClass">
                    @Model.Status
                </span>
                <span class="service-request__priority service-request__priority--@Model.Priority">
                    <span class="service-request__priority-dot"></span>
                    <span>
                        @switch (Model.Priority)
                        {
                            case 1: <text>Critical Priority</text>
                                break;
                            case 2: <text>High Priority</text>
                                break;
                            case 3: <text>Medium Priority</text>
                                break;
                            case 4: <text>Low Priority</text>
                                break;
                            case 5: <text>Very Low Priority</text>
                                break;
                            default: <text>Medium Priority</text>
                                break;
                        }
                    </span>
                </span>
            </div>
        </div>

        <!-- Description Section -->
        <div class="service-request__details-section">
            <div class="service-request__details-label">Description</div>
            <div class="service-request__details-value service-request__details-value--description">
                @Model.Description
            </div>
        </div>

        <!-- Location Section -->
        <div class="service-request__details-section">
            <div class="service-request__details-label">Location</div>
            <div class="service-request__details-value">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" style="display: inline-block; vertical-align: middle; margin-right: 8px;">
                    <path d="M8 0C5.2 0 3 2.2 3 5c0 3.8 5 11 5 11s5-7.2 5-11c0-2.8-2.2-5-5-5zm0 7c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"/>
                </svg>
                @Model.Location
            </div>
        </div>

        <!-- Meta Information Grid -->
        <div class="service-request__details-section">
            <div class="service-request__details-meta">
                <div class="service-request__details-meta-item">
                    <span class="service-request__details-label">Date Reported</span>
                    <span class="service-request__details-value">
                        @Model.DateReported.ToString("MMMM dd, yyyy 'at' h:mm tt")
                    </span>
                </div>
                <div class="service-request__details-meta-item">
                    <span class="service-request__details-label">Category</span>
                    <span class="service-request__details-value">@Model.Category</span>
                </div>
                <div class="service-request__details-meta-item">
                    <span class="service-request__details-label">Priority Level</span>
                    <span class="service-request__details-value">
                        @switch (Model.Priority)
                        {
                            case 1: <text>1 - Critical</text>
                                break;
                            case 2: <text>2 - High</text>
                                break;
                            case 3: <text>3 - Medium</text>
                                break;
                            case 4: <text>4 - Low</text>
                                break;
                            case 5: <text>5 - Very Low</text>
                                break;
                            default: <text>3 - Medium</text>
                                break;
                        }
                    </span>
                </div>
                <div class="service-request__details-meta-item">
                    <span class="service-request__details-label">Current Status</span>
                    <span class="service-request__details-value">
                        <span class="service-request__status @statusClass" style="display: inline-flex;">
                            @Model.Status
                        </span>
                    </span>
                </div>
            </div>
        </div>

        <!-- Attachments Section -->
        @if (Model.AttachmentPaths != null && Model.AttachmentPaths.Any())
        {
            <div class="service-request__details-section">
                <div class="service-request__details-label">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" style="display: inline-block; vertical-align: middle; margin-right: 8px;">
                        <path d="M14 4.5V14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h5.5L14 4.5zm-3 0A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V4.5h-2z"/>
                    </svg>
                    Attachments (@Model.AttachmentPaths.Count)
                </div>
                <div class="service-request__attachments">
                    @foreach (var attachment in Model.AttachmentPaths)
                    {
                        <div class="service-request__attachment">
                            <img src="/uploads/@attachment" alt="Attachment" class="service-request__attachment-image" />
                            <a href="/uploads/@attachment" target="_blank" class="service-request__attachment-link">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                                    <path d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                                </svg>
                            </a>
                        </div>
                    }
                </div>
            </div>
        }
    </div>

    <!-- Dependencies Card (Graph Visualization) -->
    <div class="service-request__details-card">
        <div class="service-request__dependencies">
            <h3 class="service-request__dependencies-title">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline-block; vertical-align: middle; margin-right: 8px;">
                    <circle cx="12" cy="12" r="3"/>
                    <circle cx="12" cy="5" r="2"/>
                    <circle cx="19" cy="12" r="2"/>
                    <circle cx="12" cy="19" r="2"/>
                    <circle cx="5" cy="12" r="2"/>
                    <line x1="12" y1="7" x2="12" y2="9"/>
                    <line x1="12" y1="15" x2="12" y2="17"/>
                    <line x1="15" y1="12" x2="17" y2="12"/>
                    <line x1="7" y1="12" x2="9" y2="12"/>
                </svg>
                Related Requests (Dependency Graph - BFS Traversal)
            </h3>
            <p style="font-size: 14px; color: #6B7280; margin-bottom: 16px;">
                This section uses Graph data structure with Breadth-First Search to show related service requests
            </p>
            
            @if (Model.DependencyIssues != null && Model.DependencyIssues.Any())
            {
                <div class="service-request__dependencies-list">
                    @foreach (var dependency in Model.DependencyIssues)
                    {
                        <div class="service-request__dependency-item">
                            <div class="service-request__dependency-info">
                                <a href="/ServiceRequest/Details/@dependency.Id" class="service-request__dependency-id">
                                    #MSP-@DateTime.Now.Year-@dependency.Id.ToString("D6")
                                </a>
                                <span class="service-request__dependency-desc">
                                    @(dependency.Description.Length > 80 ? dependency.Description.Substring(0, 80) + "..." : dependency.Description)
                                </span>
                            </div>
                            <div>
                                @{
                                    var depStatusClass = dependency.Status?.ToLower() switch
                                    {
                                        "pending" => "service-request__status--pending",
                                        "inprogress" => "service-request__status--inprogress",
                                        "completed" => "service-request__status--completed",
                                        "cancelled" => "service-request__status--cancelled",
                                        _ => "service-request__status--pending"
                                    };
                                }
                                <span class="service-request__status @depStatusClass">
                                    @dependency.Status
                                </span>
                            </div>
                        </div>
                    }
                </div>
            }
            else
            {
                <div class="service-request__dependencies-empty">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#D1D5DB" stroke-width="2" style="margin: 0 auto 12px; display: block;">
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="12" y1="8" x2="12" y2="12"/>
                        <line x1="12" y1="16" x2="12.01" y2="16"/>
                    </svg>
                    <p style="margin: 0;">This request has no related dependencies</p>
                    <p style="margin: 8px 0 0 0; font-size: 12px; color: #9CA3AF;">
                        Dependencies track relationships between service requests using a Graph data structure
                    </p>
                </div>
            }
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="service-request__actions">
        <div class="service-request__actions-left">
            <a href="/ServiceRequest" class="service-request__button">
                <span class="service-request__button-icon">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M10 12L6 8l4-4"/>
                    </svg>
                </span>
                <span>Back to List</span>
            </a>
        </div>
        <div class="service-request__actions-right">
            <a href="/Issue/Create" class="service-request__button service-request__button--primary">
                <span class="service-request__button-icon">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M8 2V14M2 8H14" stroke="white" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </span>
                <span>Report New Issue</span>
            </a>
        </div>
    </div>
</div>

